---
layout: post
title: UnifiedAPI统一调度平台需求说明与概要设计文档
abbrlink: 9d411a28d1b54cdab8c1ca58268d450b
tags: []
categories:
  - 工作笔记
  - 测试相关
date: 1756200728489
updated: 1756281746329
---

 

文档修订记录

|           |      |    |
| --------- | ---- | -- |
| 日期        | 编辑人员 | 内容 |
| 2025.8.22 | 卢敬聪  | 初稿 |

 

 

# 1  **项目概述**

 

## 1.1 **项目背景**

为应对市场竞争，实现公司产品多元化并开拓新的销售渠道，销售部门提出构建一个API统一调度平台。该平台旨在整合多个第三方厂商（如Google Gemini, Translate等）的API服务，通过统一、安全、可靠的接口提供给我们的客户，降低客户对接多个厂商的复杂性，同时为公司创造新的营收增长点。初步将平台命名为UnifiedAPI。

## 1.2 **问题陈述**

客户痛点：需要同时使用多个AI服务商（如Gemini，翻译）的API时，面临不同厂商的接口规范、鉴权方式、计费模式不一，管理多个API Key繁琐，账单分散难以统一查看等问题。

公司痛点：现有产品线相对单一，缺乏平台型产品作为支撑，难以形成产品矩阵和交叉销售。

## 1.3 **项目目标**

短期目标（V1.x）：打造一个最小可行产品（MVP），集成Google Gemini和Translate API，实现基本的API调用、鉴权、计费和客户管理功能，验证商业模式。

长期目标：持续集成更多厂商的API，成为企业级一站式API服务调度与分发平台，构建开发者生态，成为公司核心产品与渠道。

## 1.4 **用户角色与画像**

|                                               |                                                               |                                                                |
| --------------------------------------------- | ------------------------------------------------------------- | -------------------------------------------------------------- |
| <span style="color: rgb(0,0,0);">角色</span>    | <span style="color: rgb(0,0,0);">核心职责</span>                  | <span style="color: rgb(0,0,0);">需求与痛点</span>                  |
| <span style="color: rgb(0,0,0);">终端客户</span>  | <span style="color: rgb(0,0,0);">在客户端调用API接口集成到自己的应用中</span>  | <span style="color: rgb(0,0,0);">接口稳定、延迟低、计费清晰、Key管理方便</span>  |
| <span style="color: rgb(0,0,0);">运营管理员</span> | <span style="color: rgb(0,0,0);">在运营端管理客户、项目、查看全局账单和数据</span> | <span style="color: rgb(0,0,0);">客户信息管理、权限分配、财务对账、数据可视化</span> |
| <span style="color: rgb(0,0,0);">系统管理员</span> | <span style="color: rgb(0,0,0);">维护平台系统健康</span>              | <span style="color: rgb(0,0,0);">系统部署、监控、告警、故障处理</span>        |

 

## 1.5 **名词解释**

Unified平台AK/SK：本平台为客户分配的访问密钥（Access Key / Secret Key），用于调用本平台接口。

GCP AK/SK：客户最终使用的GCP的访问密钥，由本平台代为中转调用，实际GCP密钥不提供给客户。

P2系统：百道公司现有的账单系统，本项目需要与之进行数据交互（如获取账单）。

 

# 2 **总体业务流程**

 

<img width="648" height="115" src="/resources/9de4fcf649444f1fad2c99617a9381d6.jpg" class="jop-noMdConv"> 

## 2.1 **各业务流程**

<img width="648" height="881" src="/resources/bd25947250764658b9ea1c9d93456e5f.jpg" class="jop-noMdConv"> 

# 3 **系&#x7EDF;****功能****&#x8BF4;明**

 

# 4 **非功能性需求**

 

1\. 性能：

API网关平均响应延迟 < 500ms（不包括第三方API本身耗时）。

系统支持至少100 QPS的并发请求。

2\. 安全性：

所有API调用必须使用HTTPS。

Unified SK、GCP SK等敏感密钥在数据库中必须加密存储（如AES）。

完善的密钥鉴权机制，防止密钥泄露后被盗用。

防止重放攻击。

3\. 可用性：

系统可用性SLA目标为99.9%。

4\. 可扩展性：

架构设计应易于集成新的第三方API厂商。

 

# 5 **概要设计**

 

## 5.1 **系统架构图**

 

 

## 5.2 **核心模块设计**

 

1. 域名：

一级域名：UnifiedAPI.cloud

二级域名：厂商

三级域名：实际调用服务名

2. API网关层（API Gateway）：

职责：统一的请求入口、流量控制、日志记录、请求/响应转换。

技术：可使用FastAPI等高性能框架。

2\. 认证鉴权模块（Auth）：

实现AK/SK签名验证算法。

查询数据库，完成Unified AK/SK到客户身份的映射。

查询该客户下的项目及对应的GCP AK/SK。

3\. 厂商适配层（Adapter）：

职责：隔离不同厂商API的差异。每个厂商（或每个API）都有一个独立的适配器。

功能：将平台的通用请求参数转换为厂商特定的格式，调用厂商API，再将厂商响应转换为平台通用格式。

设计模式：采用工厂模式或策略模式，便于未来扩展新的API。

4\. 账单服务（Billing Service）：

职责：异步记录每一次API调用的明细（客户、项目、时间、Token消耗等）。

功能：提供账单汇总和查询接口，数据来源包括自身日志和P2系统。

 

## 5.3 **数据库ER图（核心字段）**

 

<img width="646" height="580" src="/resources/5a1e1d310aa54416a92dd14fc83d74ce.jpg" class="jop-noMdConv"> 

## 5.4 **API调用鉴权序列图**

 

<img width="1028" height="592" src="/resources/0aaed831f501447c9433f7200f4dd397.jpg" class="jop-noMdConv"> 

# 6 **版本发布计划**

 

  <!-- 自定义样式开始 -->

<style>
/* 隐藏顶部导航栏 (包括Joplin图标和链接) */
body.page-note nav.navbar {
    display: none !important;
}

/* 隐藏底部的“Powered by Joplin”的页脚 (可选) */
body.page-note > div.footer {
    display: none !important;
}

/* 调整页面内容，使其从顶部开始（可选，避免隐藏顶部导航后页面内容没有抬高） */
body.page-note > div.content {
    padding-top: 20px !important; 
}
</style>

  <!-- 自定义样式结束-->
